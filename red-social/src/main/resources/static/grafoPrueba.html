<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Visualizar Grafo de Estudiantes</title>
  <script type="text/javascript" src="https://unpkg.com/vis-network@9.1.2/standalone/umd/vis-network.min.js"></script>
  <style>
    #grafo {
      width: 100%;
      height: 90vh;
      border: 1px solid lightgray;
    }
  </style>

</head>
<body>
<h2>Grafo de Estudiantes</h2>
<div id="grafo"></div>

<script>
  const token = localStorage.getItem('token'); // AsegÃºrate de que tenga el prefijo "Bearer ..."

  fetch('http://localhost:8080/api/grafo/visualizar', {
    headers: {
      'Authorization': token
    }
  })
          .then(response => {
            if (!response.ok) {
              throw new Error("Error al obtener el grafo");
            }
            return response.json();
          })
          .then(grafo => {
            const nodes = grafo.nodos.map(est => ({
              id: est.id,
              label: est.username || est.email,
              title: `Email: ${est.email}`
            }));

            const edges = grafo.aristas.map(a => ({
              from: a.origen,
              to: a.destino,
              label: String(a.peso),
              arrows: 'to',
              font: { align: 'top' }
            }));

            const container = document.getElementById('grafo');
            const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
            const options = {
              layout: {
                improvedLayout: true
              },
              edges: {
                smooth: true,
                arrows: { to: { enabled: true, scaleFactor: 0.5 } }
              },
              physics: {
                stabilization: false
              }
            };
            new vis.Network(container, data, options);
          })
          .catch(error => {
            console.error("Error al visualizar el grafo:", error);
          });
</script>
</body>
</html>
